import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Input } from '@/components/ui/input';

// Exact color constants from original
const COLORS = {
  total: '#028090',
  democratic: '#2889FF',
  republican: '#D1495B',
  other: '#63B893',
  background: '#FFFFFF',
  text: '#0B132B'
};

const counties = [
  'Carson City', 'Churchill', 'Clark', 'Douglas', 'Elko', 'Esmeralda', 
  'Eureka', 'Humboldt', 'Lander', 'Lincoln', 'Lyon', 'Mineral', 
  'Nye', 'Pershing', 'Storey', 'Washoe', 'White Pine'
];

const InteractiveDashboard = () => {
  const [countyData, setCountyData] = useState(
    counties.map(county => ({
      county,
      democratic: 0,
      republican: 0,
      other: 0,
      activeVoters: 1000
    }))
  );

  const statewide = countyData.reduce((acc, county) => ({
    democratic: acc.democratic + Number(county.democratic),
    republican: acc.republican + Number(county.republican),
    other: acc.other + Number(county.other),
    activeVoters: acc.activeVoters + Number(county.activeVoters),
  }), {
    democratic: 0,
    republican: 0,
    other: 0,
    activeVoters: 0
  });

  const total = statewide.democratic + statewide.republican + statewide.other;

  const getColorIntensity = (dem, rep) => {
    if (dem === 0 && rep === 0) return '#E8E8E8';
    const total = dem + rep;
    const margin = Math.abs(dem - rep) / total;
    const intensity = Math.min(margin / 0.1, 1); // 10% margin for full intensity, matching original
    
    return dem > rep 
      ? `rgba(40, 137, 255, ${intensity})`
      : `rgba(209, 73, 91, ${intensity})`;
  };

  const handleInputChange = (county, field, value) => {
    setCountyData(prevData =>
      prevData.map(c =>
        c.county === county
          ? { ...c, [field]: Math.max(0, Number(value)) }
          : c
      )
    );
  };

  return (
    <div className="w-full max-w-6xl mx-auto p-4 space-y-6" style={{ fontFamily: 'Libre Franklin, sans-serif' }}>
      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        {/* Total Votes Card */}
        <Card className="bg-white shadow-sm">
          <CardContent className="pt-6">
            <h3 style={{ color: COLORS.total }} className="text-lg font-semibold mb-2">Total Early Votes</h3>
            <div style={{ color: COLORS.total, fontSize: '2em', fontWeight: 'bold' }}>
              {total.toLocaleString()}
            </div>
            <div style={{ color: COLORS.total }}>
              {((total / statewide.activeVoters) * 100).toFixed(2)}% of Active Voters
            </div>
          </CardContent>
        </Card>

        {/* Democratic Card */}
        <Card className="bg-white shadow-sm">
          <CardContent className="pt-6">
            <h3 style={{ color: COLORS.democratic }} className="text-lg font-semibold mb-2">Democratic</h3>
            <div style={{ color: COLORS.democratic, fontSize: '2em', fontWeight: 'bold' }}>
              {statewide.democratic.toLocaleString()}
            </div>
            <div style={{ color: COLORS.democratic }}>
              {((statewide.democratic / total) * 100).toFixed(2)}% of Early Votes
            </div>
          </CardContent>
        </Card>

        {/* Republican Card */}
        <Card className="bg-white shadow-sm">
          <CardContent className="pt-6">
            <h3 style={{ color: COLORS.republican }} className="text-lg font-semibold mb-2">Republican</h3>
            <div style={{ color: COLORS.republican, fontSize: '2em', fontWeight: 'bold' }}>
              {statewide.republican.toLocaleString()}
            </div>
            <div style={{ color: COLORS.republican }}>
              {((statewide.republican / total) * 100).toFixed(2)}% of Early Votes
            </div>
          </CardContent>
        </Card>

        {/* Other Card */}
        <Card className="bg-white shadow-sm">
          <CardContent className="pt-6">
            <h3 style={{ color: COLORS.other }} className="text-lg font-semibold mb-2">Other</h3>
            <div style={{ color: COLORS.other, fontSize: '2em', fontWeight: 'bold' }}>
              {statewide.other.toLocaleString()}
            </div>
            <div style={{ color: COLORS.other }}>
              {((statewide.other / total) * 100).toFixed(2)}% of Early Votes
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Map */}
      <Card className="bg-white shadow-sm">
        <CardHeader>
          <CardTitle style={{ color: COLORS.text, fontFamily: 'Libre Franklin, sans-serif', fontWeight: 700 }}>
            County Results
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="w-full aspect-[4/3] bg-white">
            <svg viewBox="0 0 400 300">
              {counties.map((county, i) => {
                const countyData = countyData.find(c => c.county === county);
                const x = (i % 4) * 100;
                const y = Math.floor(i / 4) * 75;
                return (
                  <g key={county}>
                    <rect
                      x={x + 10}
                      y={y + 10}
                      width={80}
                      height={55}
                      fill={getColorIntensity(
                        countyData.democratic,
                        countyData.republican
                      )}
                      stroke="#FFFFFF"
                      strokeWidth="0.8"
                      className="county"
                    />
                    <text
                      x={x + 50}
                      y={y + 40}
                      textAnchor="middle"
                      fill={COLORS.text}
                      style={{ fontFamily: 'Libre Franklin, sans-serif' }}
                      fontSize="8"
                    >
                      {county}
                    </text>
                  </g>
                );
              })}
            </svg>
          </div>
        </CardContent>
      </Card>

      {/* Data Input Grid */}
      <Card className="bg-white shadow-sm">
        <CardHeader>
          <CardTitle style={{ color: COLORS.text, fontFamily: 'Libre Franklin, sans-serif', fontWeight: 700 }}>
            County Data Input
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead className="bg-[#0B132B] text-white font-bold">County</TableHead>
                <TableHead className="bg-[#2889FF] text-white">Democratic</TableHead>
                <TableHead className="bg-[#D1495B] text-white">Republican</TableHead>
                <TableHead className="bg-[#63B893] text-white">Other</TableHead>
                <TableHead className="bg-[#028090] text-white">Active Voters</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {countyData.map((county) => (
                <TableRow key={county.county}>
                  <TableCell className="font-bold text-[#0B132B]">{county.county}</TableCell>
                  <TableCell>
                    <Input
                      type="number"
                      value={county.democratic}
                      onChange={(e) => handleInputChange(county.county, 'democratic', e.target.value)}
                      className="w-24"
                    />
                  </TableCell>
                  <TableCell>
                    <Input
                      type="number"
                      value={county.republican}
                      onChange={(e) => handleInputChange(county.county, 'republican', e.target.value)}
                      className="w-24"
                    />
                  </TableCell>
                  <TableCell>
                    <Input
                      type="number"
                      value={county.other}
                      onChange={(e) => handleInputChange(county.county, 'other', e.target.value)}
                      className="w-24"
                    />
                  </TableCell>
                  <TableCell>
                    <Input
                      type="number"
                      value={county.activeVoters}
                      onChange={(e) => handleInputChange(county.county, 'activeVoters', e.target.value)}
                      className="w-24"
                    />
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </CardContent>
      </Card>
    </div>
  );
};

export default InteractiveDashboard;
